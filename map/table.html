<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>جدول المعلومات التفصيلية للمشاريع الاستثمارية</title>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; padding: 20px; }
    h1 { margin-bottom: 10px; }
    h2 { color: #333; margin-top: 30px; }
    h3 { color: #555; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
    th { background-color: #eee; }
  </style>
</head>
<body>

<h1>قائمة المشاريع الاستثمارية</h1>
<div id="tables-container"></div>

<script>
fetch('data/geojson_grouped.json')
  .then(res => res.json())
  .then(data => {
    const container = document.getElementById("tables-container");

    Object.keys(data).forEach(groupKey => {
      if (!groupKey.startsWith("group_")) return;
      const group = data[groupKey];
      const groupName = group.__group_name__ || groupKey;

      const groupTitle = document.createElement("h2");
      groupTitle.textContent = "المجموعة: " + groupName;
      container.appendChild(groupTitle);

      Object.keys(group).forEach(layerName => {
        if (layerName.startsWith("__")) return;
        const layer = group[layerName];
        if (!layer.features) return;

        const visibleFields = layer.features[0].properties.__visible_fields__;
        if (!visibleFields) return;

        const title = document.createElement("h3");
        title.textContent = layerName;
        container.appendChild(title);

        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");
        visibleFields.forEach(f => {
          const th = document.createElement("th");
          th.textContent = f.alias;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        layer.features.forEach(feat => {
          const row = document.createElement("tr");
          visibleFields.forEach(f => {
            const td = document.createElement("td");
            td.textContent = feat.properties[f.name] || "";
            row.appendChild(td);
          });
          tbody.appendChild(row);
        });
        table.appendChild(tbody);

        container.appendChild(table);
      });
    });
  });
</script>

</body>
</html>
